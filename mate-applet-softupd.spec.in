%global pixmapdir       %{_datadir}/pixmaps
%global iconsdir        %{_datadir}/icons
%global localedir       %{_datadir}/locale

Name:           mate-applet-softupd
Version:        @PACKAGE_VERSION@
Release:        1%{?dist}
Summary:        MATE Software Update Applet
Group:          Applications/System
License:        GPLv2
URL:            http://www.zavedil.com/mate-software-updates-applet/
Source:         ihttp://www.zavedil.com/wp-content/uploads/2013/01/mate-applet-softupd-@PACKAGE_VERSION@.tar.gz
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
BuildRequires:  mate-panel-devel >= 1.3.0
BuildRequires:  libmatenotify-devel >= 1.2.0
BuildRequires:  gettext
BuildRequires:  automake
BuildRequires:  autoconf

# This actually depends on the selected backends...
#BuildRequires:  PackageKit-glib-devel
#BuildRequires:  PackageKit
#BuildRequires:  yumex
#Requires:       PackageKit
#Requires:       yumex




%description
Software updates notification applet for the MATE desktop environment.

#-------------------------------------------------------------------------------
%prep
#-------------------------------------------------------------------------------
# If you want to build the RPM in-tree (make rpm), comment out next line
%setup -q

#-------------------------------------------------------------------------------
%build
#-------------------------------------------------------------------------------
# If you want to build the RPM in-tree (make rpm), comment out next line
%configure
make %{?_smp_mflags} CFLAGS="${CFLAGS}"

#-------------------------------------------------------------------------------
%install
#-------------------------------------------------------------------------------

rm -rf "${RPM_BUILD_ROOT}"
mkdir -p "${RPM_BUILD_ROOT}%{_libexecdir}"
mkdir -p "${RPM_BUILD_ROOT}%{pixmapdir}"
mkdir -p "${RPM_BUILD_ROOT}%{iconsdir}/hicolor/16x16/apps"
mkdir -p "${RPM_BUILD_ROOT}%{iconsdir}/hicolor/22x22/apps"
mkdir -p "${RPM_BUILD_ROOT}%{iconsdir}/hicolor/24x24/apps"
mkdir -p "${RPM_BUILD_ROOT}%{iconsdir}/hicolor/32x32/apps"
mkdir -p "${RPM_BUILD_ROOT}%{_datadir}/mate-panel/applets"
mkdir -p "${RPM_BUILD_ROOT}%{_datadir}/dbus-1/services"

for DIR in `find po/ -maxdepth 1 -mindepth 1 -type d | sed s/po.//g`
do      mkdir -p "${RPM_BUILD_ROOT}%{localedir}/${DIR}/LC_MESSAGES"
done

make install DESTDIR="${RPM_BUILD_ROOT}"

%find_lang mate-applet-softupd

#-------------------------------------------------------------------------------
%post
#-------------------------------------------------------------------------------

gtk-update-icon-cache -f -t %{iconsdir}/hicolor

#-------------------------------------------------------------------------------
%clean
#-------------------------------------------------------------------------------

rm -rf "${RPM_BUILD_ROOT}"

#-------------------------------------------------------------------------------
%files -f mate-applet-softupd.lang
#-------------------------------------------------------------------------------

%defattr(-, root, root, -)
%doc AUTHOR BUGS COPYING ChangeLog INSTALL NEWS README TODO
%{_libexecdir}/softupd_applet
%{pixmapdir}/applet_softupd_on.png
%{pixmapdir}/applet_softupd_off.png
%{iconsdir}/hicolor/16x16/apps/applet_softupd.png
%{iconsdir}/hicolor/22x22/apps/applet_softupd.png
%{iconsdir}/hicolor/24x24/apps/applet_softupd.png
%{iconsdir}/hicolor/32x32/apps/applet_softupd.png
%{_datadir}/mate-panel/applets/org.mate.applets.SoftupdApplet.mate-panel-applet
%{_datadir}/dbus-1/services/org.mate.panel.applet.SoftupdApplet.service

#-------------------------------------------------------------------------------
%changelog
#-------------------------------------------------------------------------------

* Thu Mar 7 2013 Assen Totin <assen.totin@gmail.com>
- Release 0.2.5

* Mon Jan 28 2013 Assen Totin <assen.totin@gmail.com>
- Release 0.2.4

* Sun Dec 2 2012 Assen Totin <assen.totin@gmail.com>
- Release 0.2.3

* Fri Jul 27 2012 Assen Totin <assen.totin@gmail.com>
- Release 0.2.2

* Thu Jul 12 2012 Assen Totin <assen.totin@gmail.com>
- Release 0.1.0

* Wed Jun 27 2012 Assen Totin <assen.totin@gmail.com>
- Release 0.0.1

