# Author: Assen Totin <assen.totin@gmail.com>
#
# This software is released under GNU General Public License.
# See the LICENSE file for details or visit http://www.gnu.org/copyleft/gpl.html 
# for details.

CC = @MAKEFILE_CC@
CFLAGS = -c -O2

BINDIR = @BINDIR@ 
LIBEXECDIR = @LIBEXECDIR@
PIXMAPDIR = @PIXMAPDIR@
ICONSDIR = @ICONSDIR@
DATAROOTDIR = @DATAROOTDIR@

INCLUDES=`pkg-config --cflags-only-I glib-2.0 libmatepanelapplet-3.0 libmatenotify @ADDITIONAL_PACKAGES@`
LIBS=`pkg-config --libs glib-2.0 libmatepanelapplet-3.0 libmatenotify @ADDITIONAL_PACKAGES@`

TARGET = softupd_applet

OBJS_MAIN = main.o
OBJS_BACKEND = @OBJS_BACKEND@
SRC_BACKEND = @SRC_BACKEND@

all: $(TARGET)

clean:
	rm -f *.o $(TARGET)

distclean:
	make clean
	rm -f Makefile
	rm -f org.mate.applets.SoftupdApplet.mate-panel-applet
	rm -f org.mate.panel.applet.SoftupdApplet.service

maintainer-clean:
	make distclean

install:
	test -z $(DESTDIR)$(LIBEXECDIR)/mate-panel || mkdir -p $(DESTDIR)$(LIBEXECDIR)/mate-panel
	cp -f $(TARGET) $(DESTDIR)$(LIBEXECDIR)/mate-panel
	test -z $(DESTDIR)$(PIXMAPDIR) || mkdir -p $(DESTDIR)$(PIXMAPDIR)
	cp -f images/applet_softupd_on.png $(DESTDIR)$(PIXMAPDIR)
	cp -f images/applet_softupd_off.png $(DESTDIR)$(PIXMAPDIR)
	test -z $(DESTDIR)$(ICONSDIR)/hicolor/16x16/apps/ || mkdir -p $(DESTDIR)$(ICONSDIR)/hicolor/16x16/apps/
	cp -f images/applet_softupd.16.png $(DESTDIR)$(ICONSDIR)/hicolor/16x16/apps/applet_softupd.png
	test -z $(DESTDIR)$(ICONSDIR)/hicolor/22x22/apps/ || mkdir -p $(DESTDIR)$(ICONSDIR)/hicolor/22x22/apps/
	cp -f images/applet_softupd.22.png $(DESTDIR)$(ICONSDIR)/hicolor/22x22/apps/applet_softupd.png
	test -z $(DESTDIR)$(ICONSDIR)/hicolor/24x24/apps/ || mkdir -p $(DESTDIR)$(ICONSDIR)/hicolor/24x24/apps/
	cp -f images/applet_softupd.24.png $(DESTDIR)$(ICONSDIR)/hicolor/24x24/apps/applet_softupd.png
	test -z $(DESTDIR)$(ICONSDIR)/hicolor/32x32/apps/ || mkdir -p $(DESTDIR)$(ICONSDIR)/hicolor/32x32/apps/
	cp -f images/applet_softupd.32.png $(DESTDIR)$(ICONSDIR)/hicolor/32x32/apps/applet_softupd.png
	if [ "x$(DESTDIR)" = "x" ] ; then gtk-update-icon-cache -f -t $(ICONSDIR)/hicolor; else echo "DESTDIR found, skipping icon cache update"; fi
	test -z $(DESTDIR)$(DATAROOTDIR)/mate-panel/applets/ || mkdir -p $(DESTDIR)$(DATAROOTDIR)/mate-panel/applets/
	cp -f org.mate.applets.SoftupdApplet.mate-panel-applet $(DESTDIR)$(DATAROOTDIR)/mate-panel/applets/
	test -z $(DESTDIR)$(DATAROOTDIR)/dbus-1/services/ || mkdir -p $(DESTDIR)$(DATAROOTDIR)/dbus-1/services/
	cp -f org.mate.panel.applet.SoftupdApplet.service $(DESTDIR)$(DATAROOTDIR)/dbus-1/services/

uninstall:
	rm -f $(TARGET) $(LIBEXECDIR)/mate-panel/$(TARGET)
	rm -f $(PIXMAPDIR)/applet_softupd_on.png
	rm -f $(PIXMAPDIR)/applet_softupd_off.png
	rm -f $(ICONSDIR)/hicolor/16x16/apps/applet_softupd.png
	rm -f $(ICONSDIR)/hicolor/22x22/apps/applet_softupd.png
	rm -f $(ICONSDIR)/hicolor/24x24/apps/applet_softupd.png
	rm -f $(ICONSDIR)/hicolor/32x32/apps/applet_softupd.png
	gtk-update-icon-cache -f -t $(ICONSDIR)/hicolor
	rm -f $(DATAROOTDIR)/mate-panel/applets/org.mate.applets.SoftupdApplet.mate-panel-applet
	rm -f $(DATAROOTDIR)/dbus-1/services/org.mate.panel.applet.SoftupdApplet.service

$(TARGET): main.c $(SRC_BACKEND)
	$(CC) $(CFLAGS) $(INCLUDES) main.c
	$(CC) $(CFLAGS) $(INCLUDES) $(SRC_BACKEND)
	$(CC) -o $@ $(LIBS) $(OBJS_MAIN) $(OBJS_BACKEND)

